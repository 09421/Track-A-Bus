@{
    ViewBag.Title = "Index";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<h2 style="color: ghostwhite;">Select a bus route</h2>
<script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.2.6/jquery.min.js"></script>
<script src="https://maps.googleapis.com/maps/api/js?v=3.exp&sensor=false"></script>
<script>
    function Init() {
        $.ajax({
            type: "POST",
            url: "Bus/GetRouteNames",
            dataType: "json",
            success: function (result) {
                var select = document.getElementById("route");
                select.options.length = 0;
                for (var i = 0; i < result.length; i++) {
                    select.options.add(new Option(result[i]));
                }
            }
        });
    }
    var selectedRoute;
    function Change(value) {
        selectedRoute = value;
        $.ajax({
            type: "POST",
            url: "Bus/GetBussesNotOnRoute",
            dataType: "json",
            data: {
                route: value,
                contentType: "application/json; charset=utf-8"
            },
            success: function (result) {
                var select = document.combo_box.ToLB;
                select.options.length = 0;
                for (var i = 0; i < result.length; i++) {
                    select.options.add(new Option(result[i]));
                }
            }
        });

        $.ajax({
            type: "POST",
            url: "Bus/GetBussesOnRoute",
            dataType: "json",
            data: {
                route: value,
                contentType: "application/json; charset=utf-8"
            },
            success: function (result) {
                var select = document.combo_box.FromLB;
                select.options.length = 0;
                for (var i = 0; i < result.length; i++) {
                    select.options.add(new Option(result[i]));
                }
            }
        });

    }

    function SaveChanges() {
        var allAdd = new Array();
        var allRemove = new Array();

        var selectAdd = document.combo_box.FromLB
        for (var i = 0; i < selectAdd.length; i++)
            allAdd.push(selectAdd.options[i].text)

        var selectRemove = document.combo_box.ToLB
        for (var i = 0; i < selectRemove.length; i++)
            allRemove.push(selectRemove.options[i].text)

        $.ajax({
            type: "POST",
            url: "Bus/SaveChanges",
            dataType: "json",
            traditional: true,
            data: {
                bussesToAdd: allAdd,
                route: selectedRoute,
                bussesToRemove: allRemove,
                contentType: "application/json; charset=utf-8"
            },
            success: function () {
                alert("Save Complete");
            }
        });
    }

    var arrFrom = new Array();
    var arrTo = new Array();
    var arrLU = new Array();
    function move(tbFrom, tbTo) {
        arrFrom = new Array();
        arrTo = new Array();
        arrLU = new Array();
        var i;
        for (i = 0; i < tbTo.options.length; i++) {
            arrLU[tbTo.options[i].text] = tbTo.options[i].value;
            arrTo[i] = tbTo.options[i].text;
        }
        var fLength = 0;
        var tLength = arrTo.length;
        for (i = 0; i < tbFrom.options.length; i++) {
            arrLU[tbFrom.options[i].text] = tbFrom.options[i].value;
            if (tbFrom.options[i].selected && tbFrom.options[i].value != "") {
                arrTo[tLength] = tbFrom.options[i].text;
                tLength++;
            }
            else {
                arrFrom[fLength] = tbFrom.options[i].text;
                fLength++;
            }
        }

        tbFrom.length = 0;
        tbTo.length = 0;
        var ii;

        for (ii = 0; ii < arrFrom.length; ii++) {
            var no = new Option();
            no.value = arrLU[arrFrom[ii]];
            no.text = arrFrom[ii];
            tbFrom[ii] = no;
        }

        for (ii = 0; ii < arrTo.length; ii++) {
            var no = new Option();
            no.value = arrLU[arrTo[ii]];
            no.text = arrTo[ii];
            tbTo[ii] = no;
        }
    }
</script>
<body onload="Init();">
    <div style="float: left; width: 50%; height: 100%; text-align: left; padding-top: 10px;">
        <h3 style="color: ghostwhite;">Bus routes</h3>
        <select id="route" multiple size="15" name="Routes" style="width: 450px" onchange="Change(this.value);">
        </select>

        <form name="combo_box">
            <table>
                <tr>
                    <td>
                        <h4 style="color: ghostwhite;">Busses on route</h4>
                        <select multiple size="15" name="FromLB" style="width: 200px">
                        </select>
                    </td>
                    <td align="center" valign="middle">
                        <input type="button" onclick="move(this.form.FromLB, this.form.ToLB)"
                            value="->"><br />
                        <input type="button" onclick="move(this.form.ToLB, this.form.FromLB)"
                            value="<-">
                    </td>
                    <td>
                        <h4 style="color: ghostwhite;">Avaliable busses</h4>
                        <select multiple size="15" name="ToLB" style="width: 200px">
                        </select>
                    </td>
                </tr>
            </table>
            <input id="SaveRoute" type="button" value="Save" onclick="SaveChanges();" style="float: initial;" />
        </form>
    </div>
    <div style="float: right; width: 50%; height: 100%; text-align: left; padding-top: 10px;">
        <h3 style="color: ghostwhite;">Create/Delete bus</h3>
        <select id="busses" multiple size="15" name="Routes" style="width: 170px" onchange="Change(this.value);">
        </select>
        <p style="color: ghostwhite;">
            Bus name:
            <input type="text" name="Busname" style="width: 100px">
        </p>
        <p>
            <input type="button" value="Add" style="width: 80px"/>
            <input type="button" value="Remove" style="width: 80px"/>
        </p>


        <input type="button" value="Save" style="width: 80px"/>
    </div>
</body>
