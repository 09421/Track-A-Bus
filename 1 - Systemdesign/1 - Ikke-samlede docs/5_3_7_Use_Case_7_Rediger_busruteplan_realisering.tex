\documentclass[Main.tex]{subfiles} 
\begin{document}

\subsubsection{Use Case 7: Rediger busruteplan}
Denne Use Case består af 3 normalforløb, der alle bliver startet fra siden \url{www.TrackABus.dk/dir}. Brugergrænsefladen for denne side kan ses på figur \ref{fig:RouteViewHjemmeside}. De 3 normalforløb består i at kunne tilføje en ny busrute til systemet, fjerne en busrute fra systemet, og ændrer den rute der allerede findes.

I normalforløb 1 vil det være muligt at oprette en hel ny busrute, og gemme den i MySQL databasen. Normalforløbet bliver initialiseret ved at administratoren trykker et sted på kortet, der symbolisere start punktet for en busrute, dette vil trigger et klik event på kortet, der vil placere en marker, der hvor der er blevet klikket. Der vil samtidigt blive sat et flag, der registrer at start punktet for ruten er blevet sat. Administratoren kan nu trykker et nyt sted på kortet, der symbolisere slut punktet for ruten. funktionen calcRoute() vil nu blive kaldt der, ved hjælp af Googles direction api, udregner en rute mellem start og slut punktet, samt få den indtegnet på kortet. Efter ruten er blevet udregnet og indtegnet har administratoren mulighed for at trække i ruten, for at placere den, så den tager den ønskede vej. Når ruten bliver indtegnet, samt når der bliver trækket i den, vil et directions\_changed event bliver triggered der vil opdatere variablerne der gemmer de markers, ruten bliver udregnet udfra. Administratoren har også mulighed, efter rutene er blevet indtegnet, at trykke på enten start eller slut markeren, dette vil trigger en klik event på det givet marker, der er nu mulighed for at trykke et nyt punkt på kortet, for at lave en rute der køre fra markeren til det nye punkt, dette vil skabe en kompleks busrute. Til sidste kan administratoren også tilføje busstoppesteder til ruten, dette gøres ved at der bliver flyttet stoppesteder fra listen 'Stops' til listen 'Stops on route'. Ved tryk på knappen 'Set bus stops', vil der blive hentet gps-koordinater fra databasen for stoppestederne i listen 'Stops on route', hvorefter de vil blive indtegnet på kortet. Når administratoren er færdig med at lave en rute og sætte stoppesteder på den, og ønsker at gemme denne på databasen, trykkers der på knappen 'Save'. Der vil nu først blive fundet alle de gps-koordinater der bliver brugt til at tegne ruten, disse bliver fundet ved brug af JavaScript funktionen getRoutePath(), efter det vil der blive lavet et asynkron kald til DirController funktionen Save(). Den tager som parameter de gps-koordinater der blev fundet med getRoutePath(), de waypoints på ruten som symbolisere star og slut punkterne, samt de punkter der er blevet lavet ved at administratoren har trukket i ruten, alle stoppesteder på ruten, de gps-koordinater der udgøre en eventuel subrute, samt dens waypoints, givet der blev lavet en kompleks busrute, den sidste parameter er rutens navn. Save() funktionen vil nu starte med at kalde ned til data tilgangs laget, for at indsætte navnet for den nye ruten i databasen, derefter vil waypoints blive indsat i databasen. Nu vil gps-koordinaterne for hele ruten blive indsat i databasen. Hvis det er blevet lavet en kompleks rute, vil de waypoints og rutepunkter blive indsat i databasen. Save funktionen vil nu kalde funktionen CalculateBusStopsForRoute() i RouteMath klassen. Denne funktion udregner mellem hvilke rutepunkter busstoppestederne skal ligge, og retunere en liste med den rigtige rækkefølge tilbage til Save() funktionen, der nu vil kalde til data tilgangs laget for at få gemt rækkefølgen på databasen.

I normalforløb 2, skal det være muligt at slette en busrute fra databasen. Denne blive initialiseret ved at administratoren vælger en busrute, fra listen over busruter, hvorefter der bliver trykket på knappen 'Delete'. Der bliver nu lavet et asynkron kald til DirController funktionen DeleteSelectedBusRoute(), der kalder ned i data tilgangs laget, til funktionen DeleteSelectedBusRouteFromDB() der sletter den valgte rute fra MySQL databasen.

Normalforløb 3 omhandler at kunne ændre i en, allerede eksisterende busrute. Normalforløb 3 bliver initialiseret ved at administratoren vælger en busrute, fra listen over alle busruter, dette vil trigger en onchange event der lavet et asynkron kald til DirController funktionen GetSelectedBusRoute() der kalder ned i data tilgangs laget for at hente den valgte rutes waypoints fra databasen. De hentede waypoints bliver sendt tilbage til viewet der nu, ved brug af Googles Directions API, udregner og indtegner på kortet den valgte rute, ud fra waypoints. Administratoren har nu mulighed for at trække i ruten for at enten den vej den skal tage, samt tilføje og fjerne stoppesteder som i normalforløb 1. Når ruten er blevet ændret, og ønskes at blive gemt, trykkers der på knappen 'SaveChanges'. Der vil nu ske to ting, det første er at den gamle rute bliver slettet fra databasen, som beskrevet i normalforløb 2, hvorefter den nye rute bliver gemt på databasen, som beskrevet i normalforløb 1.

\end{document}