\documentclass[Main.tex]{subfiles} 
\begin{document}

\subsubsection{Use Case 7: Rediger busruteplan}
Denne Use Case består af tre normalforløb, der alle bliver startet fra siden administrations hjemmesiden, under ruteredigerings siden. \footnote{Administrations hjemmeside, rute redigering: \url{www.TrackABus.dk/dir}}.\\ De tre normalforløb består i at kunne tilføje en ny busrute til systemet, fjerne en busrute fra systemet, og ændre en rute der allerede er oprettet.

I normalforløb 1 vil det være muligt at oprette en hel ny busrute, og gemme den i MySQL databasen. Normalforløbet bliver initialiseret ved, at administratoren trykker et sted på kortet, der symbolisere start punktet for en busrute, dette vil starte et click event på kortet, som placerer en markør, hvor der blev trykket. Der vil samtidigt blive sat et flag, der registrerer at start punktet for ruten er blevet sat. Administratoren kan nu trykke et nyt sted på kortet, der symboliserer slut punktet for ruten. Dette laver igen et click event som placerer endnu en marker, og kalder funktionen "calcRoute", i det, det tidligere nævnte flag er sat. Ved hjælp af Googles Direction API\footnote{For mere information, se https://developers.google.com/maps/documentation/directions/}, udregnes en rute mellem start og slut punkterne, og denne indtegnes denne på kortet. Efter ruten er blevet udregnet og indtegnet, har administratoren mulighed for at trække i ruten, for at placere den, så den følger de ønskede veje. Administratoren har også mulighed for, efter rutene er blevet indtegnet, at trykke på enten start eller slut markøren. Dette vil starte et click event på den givne markør, som muligører oprettelsen af en kompleks rute. Dette gøres ved at trykke et nyt sted på kortet, hvorefter der vil blive oprettet en rute imellem den trykkede markør, og det nye punkt. Til sidst kan administratoren også tilføje busstoppesteder til ruten. Dette gøres ved, at der bliver flyttet stoppesteder fra listen af alle stoppesteder til listen af stoppesteder på ruten. Ved tryk på knappen 'Set bus stops', vil der gps-koordinaterne for stoppestederne i listen af stoppesteder på ruten, blive hentet fra databasen, hvorefter de vil blive indtegnet som markører på kortet. Når administratoren er færdig med at oprette ruten, og denne ønskes gemt på databasen, trykkes der på knappen "Save route". Samtlige gps-koordinater, der er blevet brugt til at tegne rute, hentes. Disse bliver fundet ved brug af JavaScript funktionen "getRoutePath". Herefter vil der blive lavet et asynkront kald til DirController funktionen "Save". Gps-koordinaterne fundet med "getRoutePath", de punkter på ruten som symbolisere start og slut punkterne, de punkter der er blevet lavet ved, at administratoren har trukket i ruten, alle stoppesteder på ruten, de gps-koordinater der udgør en eventuel subrute, samt dennes waypoints(givet der blev lavet en kompleks busrute), samt rutens navn, sendes som parametre til "Save" funktionen. Denne funktion vil nu starte med at kalde ned til data tilgangs laget, for at indsætte navnet for den nye ruten i databasen. Herefter vil waypoints blive indsat i databasen og alle gps-koordinaterne for hele ruten vil ligeså blive indsat. Hvis der er blevet lavet en kompleks rute, vil de waypoints og rutepunkter der udgøre denne del, også blive indsat i databasen. Save funktionen vil nu kalde funktionen "CalculateBusStopsForRoute" i RouteMath klassen. Denne funktion udregner mellem hvilke rutepunkter, stoppestederne skal ligge i mellem, og retunere en liste med den rigtige rækkefølge tilbage til "Save" funktionen. Denne vil nu, til sidst, kalde til data access laget, for at indskrive rækkefølgen på gps-koordinaterne og stoppestederne.\\

I normalforløb 2, skal det være muligt at slette en busrute fra databasen. Denne blive initialiseret ved, at administratoren vælger en busrute fra listen af alle busruter, hvorefter der bliver trykket på knappen "Delete". Der bliver nu lavet et asynkront kald til DirController funktionen "DeleteSelectedBusRoute", som kalder ned i data tilgangs laget, som sørger for, at hele ruten og alt releateret til denne, bliver slettet fra databasen.\\

Normalforløb 3 ændringer i en allerede eksisterende busrute. Denne bliver initialiseret ved, at administratoren vælger en busrute, fra listen af alle busruter. Dette vil starte et "onchange" event, der laver et asynkront kald til DirController funktionen "GetSelectedBusRoute", som der kalder ned i data tilgangs laget hvor den valgte rutes waypoints bliver hentet fra databasen. De hentede waypoints bliver sendt tilbage til viewet, der nu ved brug af Googles Directions API\footnote{For mere information, se https://developers.google.com/maps/documentation/directions/}, udregner og indtegner på kortet den valgte rute ud fra rutens waypoints. Administratoren har nu mulighed for at trække i ruten, tilføje eller fjerne stoppesteder som i normalforløb 1. Når ruten er blevet ændret, og dette ønskes gemt, trykkes der på knappen "Save Changes". Den gamle rute vil blive slettet fra databasen, som beskrevet i normalforløb 2, hvorefter den nye rute bliver gemt på databasen, som beskrevet i normalforløb 1.

\end{document}