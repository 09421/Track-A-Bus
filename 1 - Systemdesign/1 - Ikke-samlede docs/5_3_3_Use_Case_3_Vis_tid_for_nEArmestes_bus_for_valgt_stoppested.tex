\documentclass[Main.tex]{subfiles} 
\begin{document}

\subsubsection{Use Case 3: Vis tid for nærmeste bus for valgt stoppested}

Use casen kan initialiseres efter Use Case 2 er fuldført. Når et stoppested trykkes, sættes stoppestedsnavnet i den øverste informations bar på viewet. Desuden sættes teksten i begge endestationsbokse til "Loading", og tiden sættes til "nn:nn:nn". Herefter undersøges der først om der er net. Hvis der er, undersøges der om et stoppested allerede er valgt, og dermed om Use Case 3 allerede er igang, og hvis der er, interruptes tråden. Når tråden er helt lukket, kaldes "GetBusTime" i TrackABusProvideren med rutenavnet, det valgte stoppested samt en ny MessageHandler som parametrer\\
"GetBusTime" står for at hente tiden og endestationen for den nærmeste bus, i begge retninger på ruten. Udregningen af dette ligger som en stored procedure på MySQL databasen. Dette kan læses om i afsnit \textit{9.1.3: Stored Procedures}. Når udregningerne er færdige, returneres resultaterne til TrackABusProvideren, hvor de bliver pakket ned i en Message, og sendt til MessageHandleren. MessageHandleren ligger i BusMapActivity, og sørger for at opdatere viewet. Hvis der ikke er nogen bus, som kører mod stoppestedet i en eller begge retninger, retuneres der "anyType{}" i den relevante retnings endesstations værdi. Hvis en eller begge endestations resultater er denne værdi, opdateres endestations teksten til  "No bus going in this direction" og tiden til "nn:nn:nn", for den relevante retning. Hvis endestations teksten i forvejen er "No bus going in this direction", opdateres der intet for den givne retning. Grunden til endestations værdien opdateres er, at en rute kan være kompleks med mere end to endestation, og en given bus, kan køre på samme ruten som en anden bus, men ikke have samme endestation.\\
\\Hvis tilgangen til internettet forsvinder efter et stoppested er valgt, vil opdateringstråden stadig køre, men der vil blive vist en besked om, at tiden ikke længere holdes opdateret. Herved, når forbindelsen genetableres, fortsættes tidsopdateringen på ny. Når BusMapActivity går i dvale sættes opdateringstråden på pause, og ved genåbning startes tråden igen.
På figur \ref{fig:UC3SSD} kan et simpelt sekvensdiagram for forløbet ses. Diagrammet viser en hentning af tiden og endestationer i begge retninger, hvor hentningen antages at være succesfuld.

\begin{figure}[H]
	\centering
	\includegraphics[scale=0.65]{Diagrammer/Sekvensdiagrammer/UC3SSD}
	\caption{Sekvensdiagram for hentning af endestationer og tid for nærmeste bus.}
	\label{fig:UC3SSD}
\end{figure}




\end{document}