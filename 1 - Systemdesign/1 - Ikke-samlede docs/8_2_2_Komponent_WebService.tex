\documentclass[Main.tex]{subfiles} 
\begin{document}
\subsubsection{Komponent 2: Mobile service}
Denne komponent har til formål at være mellemled mellem mobil applikationen og MySQL databasen. komponenten er blevet lavet, da mobil applikationen ikke må have direkte tilgang til MySQL databasen, da dette har store sikkerhedsmæssige implikationer. Et andet formål med denne web service er at gøre det gøre det nemt at udvikle til en anden mobil platform, da der ikke skal tænkes på database tilgang, men blot kaldes til servicen. Herudover abstraheres samtlige processeringstunge udregninger væk fra applikationen.\\\\
\textbf{Design:}\\
Mobil servicen bliver brugt til at hente data fra MySQL databasen som mobil applikationen skal bruge. Dette indebære at hente en liste af busruter, hente en bestemt rute, hente stoppestederne for en rute, hente positionen for alle busser på ruten og kalde den proceduren på databasen som udregner tiden til ankomst for den nærmeste bus ved et valgt stoppested. Tidsudregningen kan der læses mere om i afsnit \ref{9.1.3: Stored Procedures}. Web servicen er tilgængelig for alle, da de eneste funktionaliteter den udbyder er at hente data fra databasen. Med en åben web service er det muligt for alle at bruge data til at udvikle nye applikationer. \footnote{For en liste af funktioner i servicen, se \url{http://trackabus.dk/AndroidToMySQLWebService.asmx} }
På kodeudsnit \ref{lst:SoapStuff} kan der følges et eksempel på, hvad det kræver at kalde funkionen GetBusPos fra web servicen, ved brug af SOAP version 1.1.\footnote{For mere information om SOAP, se \url{http://www.w3.org/TR/2000/NOTE-SOAP-20000508/} } Det kan ses at funktionen kræver en "busNumber" input parameter i form af en string. Implementeringen af SOAP på mobil applikations siden kan findes under afsnit \textit{9.2.1: Implementering af persistens i mobil applikationen}. 

\begin{lstlisting}[caption=request til service function GetBusPos, language=XML, label={lst:SoapStuff}]
POST /AndroidToMySQLWebService.asmx HTTP/1.1
Host: trackabus.dk
Content-Type: application/soap+xml; charset=utf-8
Content-Length: length
<?xml version="1.0" encoding="utf-8"?>
<soap12:Envelope xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:xsd="http://www.w3.org/2001/XMLSchema" xmlns:soap12="http://www.w3.org/2003/05/soap-envelope">
  <soap12:Body>
    <GetbusPos xmlns="http://TrackABus.dk/Webservice/">
      <busNumber>string</busNumber>
    </GetbusPos>
  </soap12:Body>
</soap12:Envelope>}
\end{lstlisting}

På kodeudsnit \ref{lst:SoapResponse}, kan det SOAP response, servicen returner ved fuldent kald til GetBusPos. Svaret kan ses som et XML. SOAP implementeringen på applikations siden, står for at håndtere læsningen at dette træ.  Det kan ses at der retuneres en liste af Points, hvor hver Point indeholder en Lat, en Lng og et ID som alle er af datatypen string.

\begin{lstlisting}[caption=response fra service function GetBusPos, language=XML, label={lst:SoapResponse}]
HTTP/1.1 200 OK
Content-Type: application/soap+xml; charset=utf-8
Content-Length: length
<?xml version="1.0" encoding="utf-8"?>
<soap12:Envelope xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:xsd="http://www.w3.org/2001/XMLSchema" xmlns:soap12="http://www.w3.org/2003/05/soap-envelope">
  <soap12:Body>
    <GetbusPosResponse xmlns="http://TrackABus.dk/Webservice/">
      <GetbusPosResult>
        <Point>
          <Lat>string</Lat>
          <Lng>string</Lng>
          <ID>string</ID>
        </Point>
        <Point>
          <Lat>string</Lat>
          <Lng>string</Lng>
          <ID>string</ID>
        </Point>
      </GetbusPosResult>
    </GetbusPosResponse>
  </soap12:Body>
</soap12:Envelope>
\end{lstlisting}

\end{document}