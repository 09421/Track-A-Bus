\documentclass[Main.tex]{subfiles} 
\begin{document}

\subsubsection{Use Case 3: Vis tid for nærmeste bus for valgt stoppested}

Use casen kan initieres efter Use Case 2 er fuldført, og et kort er vist med ruter og stoppesteder, men opdaterende busser. Når et stoppested trykkes, sættes stoppestedsnavnet i den øverste informations bar på viewet. Desuden sættes teksten i begge endestationsbokse til "Loading", og tiden sættes til "nn:nn:nn". Herefter undersøges der først om der er net. Hvis der er, undersøges der om et stoppested allerede er valgt, og dermed om Use Case 3 allerede er igang, og hvis der er, interruptes tråden. Når tråden er helt lukket, kaldes GetBusTime i TrackABusProvideren med ruten, det valgte stoppested samt en ny MessageHandler.\\
GetBusTime står for at hente tiden og endestationen for den nærmeste bus, i begge retninger på ruten. Udregningen af dette ligger som en stored procedure på MySQL databasen. Dette kan læses om i afsnit \textit{9.1.2: Stored Procedures}. Når udregningerne er færdige, returneres resultaterne til TrackABusProvideren, hvor de bliver pakket ned i en Message, og sendt til MessageHandleren. MessageHandleren ligger i BusMapActivity, og sørger for at sætte resultaterne, i de rigtige views. Hvis der ikke er nogen bus, som kører forbi stoppestedet i en eller begge retninger, retuneres der "anyType{}" i den relevante retnings endesstations værdi. Hvis en eller begge endestations resultater er denne værdi, opdateres endestations teksten til  "No bus going in this direction" og tiden til "nn:nn:nn", for den relevante retning. Hvis endestations teksten i forvejen er "No bus going in this direction", opdateres der der intet for den givne retning. Grunden til endestations værdien opdateres er, at en rute kan være kompleks med mere end to stoppesteder, og en given bus, kan have køre på samme ruten som en anden bus, men ikke have samme endestation.\\
\\Hvis internettet ikke kan tilgås under protokollen, vil tråden stadig køre, men der vil blive vist en besked om, at tiden ikke længere holdes opdateret. Herved, når forbindelsen genskabes, fortsættes tidsopdateringen på ny. Når BusMapActivity går i dvale sættes tidsopdaterings tråden på pause, og når servicen bindes igen, ved genåbning, startes processen igen.
På \ref{fig:UC3SSD} kan et simpelt sekvensdiagram, for forløbet ses. Den viser kun en hentning, som antages at være succesfuld.

\begin{figure}[H]
	\centering
	\includegraphics[scale=0.65]{Diagrammer/Sekvensdiagrammer/UC3SSD}
	\caption{Sekvensdiagram for hentning af endestationer og tid for nærmeste bus.}
	\label{fig:UC3SSD}
\end{figure}




\end{document}